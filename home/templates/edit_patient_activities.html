{% extends 'base_administration.html' %}

{% block content %}

<style>
    /* Solid border */
hr.solid {
  border-top: 3px solid #bbb;
}
</style>

    <h2>{{ patient.first_name }} {{ patient.last_name }}</h2>

    <form action="" method="POST">
        {% csrf_token %}
        <div id="activities-formset" data-form-prefix="activities" class="formset">
            {{ formset.management_form }}
            <div class="empty-form" style="display: none;">
                {{ formset.empty_form }}
            </div>
            {% for form in formset %}
                <div class="formset-activities">
                    {{ form.as_p }}
                    <input type="hidden" name="patient" value="{{ patient.id }}">
                    <hr class="solid">
                </div>
            {% endfor %}
        </div>
        <button type="button" id="add-activities" class="add-formset-item btn btn-secondary mb-2">Přidat aktivitu</button>
        <br>
        <input type="submit" value="Uložit" class="btn btn-secondary mb-2">
    </form>

    <script>
        function addFormsetForm(formsetPrefix) {
            const managementForm = $(`#${formsetPrefix}-formset [id$='-TOTAL_FORMS']`);
            let totalForms = parseInt(managementForm.val());

            const emptyForm = $(`#${formsetPrefix}-formset .empty-form`).html();
            totalForms += 1;
            managementForm.val(totalForms + 1);

            const newForm = emptyForm.replace(/__prefix__/g, totalForms);
            const formsetContainer = $(`#${formsetPrefix}-formset`);
            formsetContainer.append(`<div class="formset-${formsetPrefix}">${newForm}<button type="button" class="delete-formset-item btn btn-danger mb-2" onclick="deleteFormsetForm(this)">Delete</button></div>`);
        }

        function deleteFormsetForm(btn) {
            $(btn).closest('.formset-' + $(btn).parent().parent().data('form-prefix')).remove();
        }

        $(document).ready(function() {
            $('#add-activities').on('click', function() {
                addFormsetForm('activities');
            });
        });
    </script>

{% endblock %}